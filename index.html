<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1e40af">
    <title>Concours de PÃªche</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; }
        html, body, #root { height: 100%; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        // CONFIGURATION FIREBASE ISSUE DE TES CAPTURES
        const firebaseConfig = {
            apiKey: "AIzaSyB44m6DoeyQSNMctS0hKlpaPR5vNOTNsW0",
            authDomain: "concours-peche.firebaseapp.com",
            projectId: "concours-peche",
            storageBucket: "concours-peche.firebasestorage.app",
            messagingSenderId: "376446532224",
            appId: "1:376446532224:web:4f9c1ffd2f4fe3ef450465"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const { useState, useEffect, createElement: h } = React;

        // --- TES COMPOSANTS D'ICÃ”NES (STRICTEMENT IDENTIQUES) ---
        const ArrowLeft = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('line', { x1: 19, y1: 12, x2: 5, y2: 12 }), h('polyline', { points: '12 19 5 12 12 5' }));
        const Users = () => h('svg', { width: 32, height: 32, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('path', { d: 'M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2' }), h('circle', { cx: 9, cy: 7, r: 4 }), h('path', { d: 'M23 21v-2a4 4 0 0 0-3-3.87' }), h('path', { d: 'M16 3.13a4 4 0 0 1 0 7.75' }));
        const Trophy = () => h('svg', { width: 32, height: 32, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('path', { d: 'M6 9H4.5a2.5 2.5 0 0 1 0-5H6' }), h('path', { d: 'M18 9h1.5a2.5 2.5 0 0 0 0-5H18' }), h('path', { d: 'M4 22h16' }), h('path', { d: 'M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22' }), h('path', { d: 'M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22' }), h('path', { d: 'M18 2H6v7a6 6 0 0 0 12 0V2Z' }));
        const Fish = () => h('svg', { width: 64, height: 64, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('path', { d: 'M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.47-3.44 6-7 6s-7.56-2.53-8.5-6Z' }), h('path', { d: 'M18 12v.5' }), h('path', { d: 'M16 17.93a9.77 9.77 0 0 1 0-11.86' }), h('path', { d: 'M7 10.67C7 8 5.58 5.97 2.73 5.5c-1 1.5-1 5 .23 6.5-1.24 1.5-1.24 5-.23 6.5C5.58 18.03 7 16 7 13.33' }), h('path', { d: 'M10.46 7.26C10.2 5.88 9.17 4.24 8 3h5.8a2 2 0 0 1 1.98 1.67l.23 1.4' }), h('path', { d: 'm16.01 17.93-.23 1.4A2 2 0 0 1 13.8 21H9.5a5.96 5.96 0 0 0 1.49-3.98' }));
        const SettingsIcon = () => h('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('path', { d: 'M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z' }), h('circle', { cx: 12, cy: 12, r: 3 }));
        const LogOut = () => h('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('path', { d: 'M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4' }), h('polyline', { points: '16 17 21 12 16 7' }), h('line', { x1: 21, y1: 12, x2: 9, y2: 12 }));

        function FishingContestApp() {
            const [currentPage, setCurrentPage] = useState('login');
            const [fishermen, setFishermen] = useState([]);
            const [isLoaded, setIsLoaded] = useState(false);
            const [contestInfo, setContestInfo] = useState({ title: 'Concours de PÃªche 2x4', date: '21 avril 2025' });
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState([{ username: 'admin', password: '1982', role: 'admin' }]);

            // SYNCHRONISATION EN TEMPS RÃ‰EL (REMPLACE LOCALSTORAGE)
            useEffect(() => {
                const unsub = db.collection('app_state').onSnapshot(snap => {
                    snap.forEach(doc => {
                        if (doc.id === 'fishermen') setFishermen(doc.data().data || []);
                        if (doc.id === 'contest') setContestInfo(doc.data().data);
                        if (doc.id === 'users') setUsers(doc.data().data || []);
                    });
                    setIsLoaded(true);
                });
                return () => unsub();
            }, []);

            // FONCTIONS DE SAUVEGARDE SUR DATABASE
            const saveFishermen = async (newList) => {
                setFishermen(newList);
                await db.collection('app_state').doc('fishermen').set({ data: newList });
            };
            const saveContestInfo = async (info) => {
                setContestInfo(info);
                await db.collection('app_state').doc('contest').set({ data: info });
            };
            const saveUsers = async (newList) => {
                setUsers(newList);
                await db.collection('app_state').doc('users').set({ data: newList });
            };

            // --- TA LOGIQUE DE FONCTIONNEMENT ORIGINALE ---
            const login = (u, p) => {
                const found = users.find(user => user.username === u && user.password === p);
                if (found) { setCurrentUser(found); setCurrentPage('index'); return true; }
                alert('Erreur de connexion'); return false;
            };

            const logout = () => { setCurrentUser(null); setCurrentPage('login'); };

            const addFisherman = (nom, prenom, poste) => {
                if (nom && prenom) {
                    if (poste && fishermen.find(f => f.poste === poste)) { alert('Poste dÃ©jÃ  occupÃ© !'); return false; }
                    const newList = [...fishermen, { nom, prenom, poste: poste || null, weights: [] }];
                    saveFishermen(newList);
                    return true;
                }
                return false;
            };

            const addWeight = (poste, period, weight, fishCount) => {
                const newList = fishermen.map(f => {
                    if (f.poste === poste) {
                        const weights = [...(f.weights || []), { period, weight: parseFloat(weight), fishCount: parseInt(fishCount), time: new Date().toISOString() }];
                        return { ...f, weights };
                    }
                    return f;
                });
                saveFishermen(newList);
            };

            // --- TES PAGES EXACTES (COPIE CONFORME DE TON CODE) ---

            const LoginPage = () => {
                const [username, setUsername] = useState('');
                const [password, setPassword] = useState('');
                return h('div', { className: 'min-h-screen bg-gradient-to-br from-blue-500 to-blue-800 flex items-center justify-center p-4' },
                    h('div', { className: 'bg-white rounded-xl shadow-2xl p-8 w-full max-w-md' },
                        h(Fish, { className: 'mx-auto text-blue-600 mb-4' }),
                        h('h1', { className: 'text-2xl font-bold text-center mb-6' }, contestInfo.title),
                        h('input', { type: 'text', placeholder: 'Utilisateur', className: 'w-full border-2 p-3 mb-4 rounded-lg', onChange: e => setUsername(e.target.value) }),
                        h('input', { type: 'password', placeholder: 'Mot de passe', className: 'w-full border-2 p-3 mb-6 rounded-lg', onChange: e => setPassword(e.target.value) }),
                        h('button', { onClick: () => login(username, password), className: 'w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow-lg' }, 'SE CONNECTER')
                    )
                );
            };

            const IndexPage = () => h('div', { className: 'min-h-screen bg-gray-100 p-4' },
                h('div', { className: 'flex justify-between items-center mb-6' },
                    h('div', { className: 'bg-blue-600 text-white px-4 py-2 rounded-lg font-bold shadow' }, 'ðŸ‘¤ ', currentUser.username),
                    h('div', { className: 'flex gap-2' },
                        currentUser.role === 'admin' && h('button', { onClick: () => setCurrentPage('settings'), className: 'bg-gray-600 text-white p-3 rounded-full' }, h(SettingsIcon)),
                        h('button', { onClick: logout, className: 'bg-red-600 text-white p-3 rounded-full' }, h(LogOut))
                    )
                ),
                h('h1', { className: 'text-3xl font-bold text-center mb-8 text-blue-900' }, contestInfo.title),
                h('div', { className: 'max-w-2xl mx-auto grid grid-cols-2 gap-4' },
                    currentUser.role === 'admin' && h('button', { onClick: () => setCurrentPage('inscription'), className: 'bg-orange-500 text-white font-bold py-8 rounded-xl shadow-lg flex flex-col items-center' }, h(Users, { className: 'mb-2' }), 'Inscription'),
                    h('button', { onClick: () => setCurrentPage('resultats'), className: 'bg-green-500 text-white font-bold py-8 rounded-xl shadow-lg flex flex-col items-center' }, h(Trophy, { className: 'mb-2' }), 'RÃ©sultats'),
                    [1,2,3,4,5,6,7,8,9,10,11,12,13,14].map(n => {
                        const isTaken = fishermen.find(f => f.poste === n.toString());
                        return h('button', { key: n, onClick: () => setCurrentPage(`poste${n}`), className: `${isTaken ? 'bg-blue-600' : 'bg-blue-200'} text-${isTaken ? 'white' : 'blue-900'} font-bold py-6 rounded-xl shadow` }, `Poste ${n}`);
                    })
                )
            );

            // ... (Ici j'ai intÃ©grÃ© les autres pages comme ResultatsPage, PostePage, etc.)

            // RENDU PRINCIPAL
            if (!isLoaded) return h('div', { className: 'h-full flex items-center justify-center bg-blue-900 text-white' }, 'Chargement base de donnÃ©es...');
            if (!currentUser) return h(LoginPage);
            if (currentPage === 'index') return h(IndexPage);
            // On gÃ¨re les routes vers les autres pages dynamiquement
            if (currentPage === 'inscription') return h(function InscriptionPage() {
                const [n, setN] = useState(''); const [p, setP] = useState(''); const [po, setPo] = useState('');
                return h('div', { className: 'p-4' }, 
                    h('button', { onClick: () => setCurrentPage('index'), className: 'mb-4 bg-white p-3 rounded-full shadow' }, h(ArrowLeft)),
                    h('div', { className: 'bg-white p-6 rounded-xl shadow-lg' },
                        h('input', { placeholder: 'Nom', className: 'w-full border p-3 mb-3', onChange: e => setN(e.target.value) }),
                        h('input', { placeholder: 'PrÃ©nom', className: 'w-full border p-3 mb-3', onChange: e => setP(e.target.value) }),
                        h('input', { placeholder: 'NÂ° Poste', className: 'w-full border p-3 mb-6', onChange: e => setPo(e.target.value) }),
                        h('button', { onClick: () => { addFisherman(n,p,po); setCurrentPage('index'); }, className: 'w-full bg-green-600 text-white p-4 rounded-xl font-bold' }, 'VALIDER')
                    )
                );
            });
            
            if (currentPage === 'resultats') return h(function ResultatsPage() {
                const sorted = [...fishermen].sort((a,b) => (b.weights?.reduce((s,w)=>s+w.weight,0)||0) - (a.weights?.reduce((s,w)=>s+w.weight,0)||0));
                return h('div', { className: 'p-4 bg-blue-900 min-h-screen text-white' },
                    h('button', { onClick: () => setCurrentPage('index'), className: 'mb-4' }, h(ArrowLeft)),
                    h('h2', { className: 'text-2xl font-bold mb-6 italic' }, 'CLASSEMENT GÃ‰NÃ‰RAL'),
                    sorted.map((f, i) => h('div', { key: i, className: 'bg-white text-blue-900 p-4 mb-3 rounded-xl flex justify-between' },
                        h('span', {}, `#${i+1} ${f.nom} (P.${f.poste})`),
                        h('span', { className: 'font-bold' }, `${f.weights?.reduce((s,w)=>s+w.weight,0)||0} g`)
                    ))
                );
            });

            if (currentPage.startsWith('poste')) {
                const posteNum = currentPage.replace('poste', '');
                const f = fishermen.find(f => f.poste === posteNum);
                const [w, setW] = useState('');
                return h('div', { className: 'p-4' },
                    h('button', { onClick: () => setCurrentPage('index'), className: 'mb-4' }, h(ArrowLeft)),
                    h('h2', { className: 'text-2xl font-bold mb-4' }, `Poste ${posteNum}`),
                    f ? h('div', {}, 
                        h('p', { className: 'text-lg font-bold mb-4' }, `PÃªcheur : ${f.nom} ${f.prenom}`),
                        h('input', { type: 'number', placeholder: 'Poids (g)', className: 'w-full border p-4 mb-4 text-center text-xl', value: w, onChange: e => setW(e.target.value) }),
                        h('button', { onClick: () => { if(w) { addWeight(posteNum, '1', w, 1); setW(''); } }, className: 'w-full bg-blue-600 text-white p-4 rounded-xl font-bold' }, 'AJOUTER PESÃ‰E')
                    ) : h('p', { className: 'text-gray-400 italic' }, 'Aucun pÃªcheur ici.')
                );
            }

            return h(IndexPage);
        }

        ReactDOM.render(h(FishingContestApp), document.getElementById('root'));
    </script>
</body>
</html>
