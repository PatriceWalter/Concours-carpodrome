<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Concours de Pêche</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- UI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

    <style>
        body { background-color: #f3f4f6; }
    </style>
</head>
<body>

<div id="root"></div>

<script>
/* ============================
   CONFIG FIREBASE
============================ */

    <!-- Firebase SDKs (OBLIGATOIRE) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

    
    const firebaseConfig = {
  apiKey: "AIzaSyD.....",
  authDomain: "concours-peche.firebaseapp.com",
  databaseURL: "https://concours-peche-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "concours-peche",
  storageBucket: "concours-peche.appspot.com",
  messagingSenderId: "1234567890",
  appId: "1:1234567890:web:abcdef123456"
};


firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const auth = firebase.auth();

/* ============================
   AUTH SIMPLE
============================ */
window.currentUser = null;

auth.onAuthStateChanged(user => {
    window.currentUser = user;
});

/* ============================
   STORAGE TEMPS RÉEL COMMUN
============================ */
window.storage = {
    get: async (key) => {
        const snap = await db.ref(key).get();
        return { value: snap.exists() ? JSON.stringify(snap.val()) : null };
    },
    set: async (key, value) => {
        await db.ref(key).set(JSON.parse(value));
    },
    on: (key, callback) => {
        db.ref(key).on("value", snap => {
            if (snap.exists()) callback(snap.val());
        });
    }
};
</script>

<script type="text/babel">
const { useState, useEffect } = React;

/* ============================
   ICON
============================ */
const Icon = ({ name }) => {
    useEffect(() => lucide.createIcons(), []);
    return <i data-lucide={name}></i>;
};

/* ============================
   APP
============================ */
const App = () => {
    const [user, setUser] = useState(null);
    const [email, setEmail] = useState("");
    const [password, setPassword] = useState("");

    const [fishermen, setFishermen] = useState([]);
    const [contestInfo, setContestInfo] = useState({ title: "Concours de Pêche", date: "" });

    useEffect(() => {
        auth.onAuthStateChanged(u => setUser(u));
    }, []);

    /* ===== SYNC TEMPS RÉEL ===== */
    useEffect(() => {
        storage.on("fishermen-list", setFishermen);
        storage.on("contest-info", setContestInfo);
    }, []);

    const login = async () => {
        await auth.signInWithEmailAndPassword(email, password);
    };

    const logout = async () => {
        await auth.signOut();
    };

    if (!user) {
        return (
            <div className="min-h-screen flex items-center justify-center">
                <div className="bg-white p-6 rounded shadow w-80">
                    <h2 className="text-xl font-bold mb-4">Connexion</h2>
                    <input className="border p-2 w-full mb-2" placeholder="Email" onChange={e=>setEmail(e.target.value)} />
                    <input type="password" className="border p-2 w-full mb-4" placeholder="Mot de passe" onChange={e=>setPassword(e.target.value)} />
                    <button onClick={login} className="bg-blue-600 text-white w-full p-2 rounded">Connexion</button>
                </div>
            </div>
        );
    }

    return (
        <div className="p-4">
            <div className="flex justify-between mb-4">
                <div className="font-bold">{contestInfo.title}</div>
                <button onClick={logout} className="text-red-600">Déconnexion</button>
            </div>

            <button
                onClick={() => storage.set("fishermen-list", [...fishermen, { nom:"Test", prenom:"User", poste:null, weights:[] }])}
                className="bg-green-600 text-white p-2 rounded"
            >
                Ajouter pêcheur test
            </button>

            <pre className="bg-white mt-4 p-4 rounded shadow text-sm">
                {JSON.stringify(fishermen, null, 2)}
            </pre>
        </div>
    );
};

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>

</body>
</html>

