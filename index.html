<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1e40af">
    <title>Concours de PÃªche - Live Firebase</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; }
        html, body, #root { height: 100%; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        // CONFIGURATION FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyB44m6DoeyQSNMctS0hKlpaPR5vNOTNsW0",
            authDomain: "concours-peche.firebaseapp.com",
            projectId: "concours-peche",
            storageBucket: "concours-peche.firebasestorage.app",
            messagingSenderId: "376446532224",
            appId: "1:376446532224:web:4f9c1ffd2f4fe3ef450465"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const { useState, useEffect, createElement: h } = React;

        // COMPOSANTS ICÃ”NES (TES ORIGINAUX)
        const ArrowLeft = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('line', { x1: 19, y1: 12, x2: 5, y2: 12 }), h('polyline', { points: '12 19 5 12 12 5' }));
        const Users = () => h('svg', { width: 32, height: 32, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('path', { d: 'M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2' }), h('circle', { cx: 9, cy: 7, r: 4 }), h('path', { d: 'M23 21v-2a4 4 0 0 0-3-3.87' }), h('path', { d: 'M16 3.13a4 4 0 0 1 0 7.75' }));
        const Trophy = () => h('svg', { width: 32, height: 32, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('path', { d: 'M6 9H4.5a2.5 2.5 0 0 1 0-5H6' }), h('path', { d: 'M18 9h1.5a2.5 2.5 0 0 0 0-5H18' }), h('path', { d: 'M4 22h16' }), h('path', { d: 'M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22' }), h('path', { d: 'M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22' }), h('path', { d: 'M18 2H6v7a6 6 0 0 0 12 0V2Z' }));
        const Fish = () => h('svg', { width: 64, height: 64, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('path', { d: 'M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.47-3.44 6-7 6s-7.56-2.53-8.5-6Z' }), h('path', { d: 'M18 12v.5' }), h('path', { d: 'M16 17.93a9.77 9.77 0 0 1 0-11.86' }), h('path', { d: 'M7 10.67C7 8 5.58 5.97 2.73 5.5c-1 1.5-1 5 .23 6.5-1.24 1.5-1.24 5-.23 6.5C5.58 18.03 7 16 7 13.33' }), h('path', { d: 'M10.46 7.26C10.2 5.88 9.17 4.24 8 3h5.8a2 2 0 0 1 1.98 1.67l.23 1.4' }), h('path', { d: 'm16.01 17.93-.23 1.4A2 2 0 0 1 13.8 21H9.5a5.96 5.96 0 0 0 1.49-3.98' }));
        const SettingsIcon = () => h('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('path', { d: 'M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z' }), h('circle', { cx: 12, cy: 12, r: 3 }));
        const LogOut = () => h('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('path', { d: 'M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4' }), h('polyline', { points: '16 17 21 12 16 7' }), h('line', { x1: 21, y1: 12, x2: 9, y2: 12 }));

        function FishingContestApp() {
            const [currentPage, setCurrentPage] = useState('login');
            const [fishermen, setFishermen] = useState([]);
            const [isLoaded, setIsLoaded] = useState(false);
            const [contestInfo, setContestInfo] = useState({ title: 'Concours de PÃªche 2x4', date: '21 avril 2025' });
            const [currentUser, setCurrentUser] = useState(null);

            // SYNCHRONISATION FIREBASE (PLUS DE LOCALSTORAGE)
            useEffect(() => {
                const unsub = db.collection('live_data').onSnapshot(snap => {
                    snap.forEach(doc => {
                        if (doc.id === 'fishermen') setFishermen(doc.data().list || []);
                        if (doc.id === 'config') setContestInfo(doc.data().info || { title: 'Concours de PÃªche 2x4', date: '21 avril 2025' });
                    });
                    setIsLoaded(true);
                });
                return () => unsub();
            }, []);

            // FONCTIONS DE SAUVEGARDE DB
            const saveFishermen = async (list) => {
                await db.collection('live_data').doc('fishermen').set({ list });
            };
            const saveContestInfo = async (info) => {
                await db.collection('live_data').doc('config').set({ info });
            };

            // GESTION CONNEXION (SIMPLIFIÃ‰E : FIREBASE EST LE MAITRE)
            const handleLogin = (u, p) => {
                if (u === 'admin' && p === '1982') {
                    setCurrentUser({ username: 'admin', role: 'admin' });
                    setCurrentPage('index');
                } else {
                    alert('AccÃ¨s refusÃ©');
                }
            };

            // LOGIQUE MÃ‰TIER CONSERVÃ‰E
            const addFisherman = (nom, prenom, poste) => {
                if (!nom || !prenom) return;
                if (poste && fishermen.find(f => f.poste === poste)) { alert('Poste occupÃ©'); return; }
                const newList = [...fishermen, { nom, prenom, poste: poste || null, weights: [] }];
                saveFishermen(newList);
            };

            const addWeight = (poste, period, weight, fishCount) => {
                const newList = fishermen.map(f => {
                    if (f.poste === poste) {
                        const weights = [...(f.weights || []), { 
                            period, weight: parseFloat(weight) || 0, 
                            fishCount: parseInt(fishCount) || 1, 
                            time: new Date().toISOString() 
                        }];
                        return { ...f, weights };
                    }
                    return f;
                });
                saveFishermen(newList);
            };

            // CALCULS (TES ORIGINAUX)
            const getTotalWeight = (f) => (f.weights || []).reduce((s, w) => s + w.weight, 0);
            const getWeightByPeriod = (f, p) => (f.weights || []).filter(w => w.period === p).reduce((s, w) => s + w.weight, 0);

            // --- PAGES (DESIGN 100% IDENTIQUE AU TIEN) ---

            if (!isLoaded) return h('div', { className: 'h-full flex items-center justify-center bg-blue-900 text-white font-bold' }, 'CHARGEMENT FIREBASE...');

            if (!currentUser) return h('div', { className: 'min-h-screen bg-blue-800 flex items-center justify-center p-4' },
                h('div', { className: 'bg-white p-8 rounded-xl shadow-2xl w-full max-w-md' },
                    h(Fish, { className: 'mx-auto mb-4 text-blue-600' }),
                    h('h1', { className: 'text-2xl font-bold text-center mb-6' }, contestInfo.title),
                    h('input', { id:'u', type: 'text', placeholder: 'Admin', className: 'w-full border-2 p-3 mb-4 rounded-lg' }),
                    h('input', { id:'p', type: 'password', placeholder: 'Code', className: 'w-full border-2 p-3 mb-6 rounded-lg' }),
                    h('button', { onClick: () => handleLogin(document.getElementById('u').value, document.getElementById('p').value), className: 'w-full bg-blue-600 text-white font-bold py-3 rounded-lg' }, 'SE CONNECTER')
                )
            );

            if (currentPage === 'index') return h('div', { className: 'min-h-screen bg-gray-100 p-4' },
                h('div', { className: 'flex justify-between items-center mb-6' },
                    h('div', { className: 'bg-blue-600 text-white px-4 py-2 rounded-lg font-bold shadow' }, 'ðŸ‘¤ Admin'),
                    h('button', { onClick: () => setCurrentUser(null), className: 'bg-red-600 text-white p-3 rounded-full' }, h(LogOut))
                ),
                h('h1', { className: 'text-3xl font-bold text-center mb-8 text-blue-900' }, contestInfo.title),
                h('div', { className: 'max-w-2xl mx-auto grid grid-cols-2 gap-4' },
                    h('button', { onClick: () => setCurrentPage('inscription'), className: 'bg-orange-500 text-white font-bold py-8 rounded-xl shadow flex flex-col items-center' }, h(Users, { className: 'mb-2' }), 'Inscription'),
                    h('button', { onClick: () => setCurrentPage('resultats'), className: 'bg-green-500 text-white font-bold py-8 rounded-xl shadow flex flex-col items-center' }, h(Trophy, { className: 'mb-2' }), 'RÃ©sultats'),
                    [1,2,3,4,5,6,7,8,9,10,11,12,13,14].map(n => {
                        const occ = fishermen.find(f => f.poste === n.toString());
                        return h('button', { key: n, onClick: () => setCurrentPage(`poste${n}`), className: `${occ ? 'bg-blue-600 text-white' : 'bg-blue-200 text-blue-900'} font-bold py-6 rounded-xl shadow` }, `Poste ${n}`);
                    }),
                    h('button', { onClick: () => setCurrentPage('settings'), className: 'col-span-2 bg-gray-600 text-white font-bold py-4 rounded-xl shadow flex items-center justify-center gap-2' }, h(SettingsIcon), 'ParamÃ¨tres Concours')
                )
            );

            if (currentPage === 'inscription') return h('div', { className: 'p-4' },
                h('button', { onClick: () => setCurrentPage('index'), className: 'mb-4' }, h(ArrowLeft)),
                h('div', { className: 'bg-white p-6 rounded-xl shadow-lg mb-6' },
                    h('h2', { className: 'text-xl font-bold mb-4' }, 'Nouveau PÃªcheur'),
                    h('div', { className: 'space-y-3' },
                        h('input', { id:'n', placeholder: 'Nom', className: 'w-full border p-3 rounded' }),
                        h('input', { id:'pr', placeholder: 'PrÃ©nom', className: 'w-full border p-3 rounded' }),
                        h('input', { id:'po', type: 'number', placeholder: 'Poste', className: 'w-full border p-3 rounded' }),
                        h('button', { onClick: () => { addFisherman(document.getElementById('n').value, document.getElementById('pr').value, document.getElementById('po').value); setCurrentPage('index'); }, className: 'w-full bg-blue-600 text-white font-bold py-3 rounded' }, 'AJOUTER')
                    )
                )
            );

            if (currentPage === 'resultats') {
                const sorted = [...fishermen].sort((a,b) => getTotalWeight(b) - getTotalWeight(a));
                return h('div', { className: 'p-4 bg-blue-900 min-h-screen text-white' },
                    h('button', { onClick: () => setCurrentPage('index'), className: 'mb-6' }, h(ArrowLeft)),
                    h('h1', { className: 'text-3xl font-black text-center mb-8 italic uppercase' }, 'ðŸ† Classement'),
                    sorted.map((f, i) => h('div', { key: i, className: 'bg-white text-blue-900 p-4 mb-3 rounded-xl flex justify-between items-center shadow-lg' },
                        h('div', {}, h('span', { className: 'font-black text-2xl mr-3 text-orange-500' }, `#${i+1}`), h('span', { className: 'font-bold' }, `${f.nom} (P.${f.poste})`)),
                        h('div', { className: 'text-xl font-black' }, `${getTotalWeight(f).toFixed(3)}kg`)
                    ))
                );
            }

            if (currentPage.startsWith('poste')) {
                const num = currentPage.replace('poste', '');
                const f = fishermen.find(f => f.poste === num);
                return h('div', { className: 'p-4' },
                    h('button', { onClick: () => setCurrentPage('index'), className: 'mb-4' }, h(ArrowLeft)),
                    h('div', { className: 'bg-white p-6 rounded-xl shadow' },
                        h('h2', { className: 'text-2xl font-bold text-center mb-4 text-blue-900' }, `Poste ${num}`),
                        f ? h('div', null,
                            h('div', { className: 'bg-yellow-100 p-4 rounded mb-4 text-center' }, h('p', {className:'font-bold text-xl'}, `${f.nom} ${f.prenom}`), h('p', {className:'text-2xl font-bold text-green-700'}, `${getTotalWeight(f).toFixed(3)} kg`)),
                            h('div', { className: 'grid grid-cols-2 gap-2 mb-4' },
                                h('input', { id:'pes', type: 'number', step: '0.001', placeholder: 'Poids (kg)', className: 'border p-4 rounded text-xl' }),
                                h('button', { onClick: () => { addWeight(num, 'matin', document.getElementById('pes').value, 1); document.getElementById('pes').value=''; }, className: 'bg-green-600 text-white font-bold rounded' }, 'AJOUTER')
                            )
                        ) : h('p', {className:'text-center italic'}, 'Libre')
                    )
                );
            }

            if (currentPage === 'settings') return h('div', { className: 'p-4' },
                h('button', { onClick: () => setCurrentPage('index'), className: 'mb-4' }, h(ArrowLeft)),
                h('div', { className: 'bg-white p-6 rounded-xl shadow' },
                    h('h2', { className: 'font-bold text-xl mb-4' }, 'ParamÃ¨tres du Concours'),
                    h('input', { className: 'w-full border p-3 mb-3 rounded', value: contestInfo.title, onChange: e => setContestInfo({...contestInfo, title: e.target.value}) }),
                    h('input', { className: 'w-full border p-3 mb-4 rounded', value: contestInfo.date, onChange: e => setContestInfo({...contestInfo, date: e.target.value}) }),
                    h('button', { onClick: () => { saveContestInfo(contestInfo); setCurrentPage('index'); }, className: 'w-full bg-green-600 text-white font-bold py-3 rounded' }, 'SAUVEGARDER DANS LE CLOUD')
                )
            );

            return h('div', null, 'Erreur de navigation');
        }

        ReactDOM.render(h(FishingContestApp), document.getElementById('root'));
    </script>
</body>
</html>
