<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Concours de PÃªche PRO</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    <script>
        // Tes clÃ©s de connexion rÃ©cupÃ©rÃ©es dans tes fichiers
        const firebaseConfig = {
          apiKey: "AIzaSyB44m6DoeyQSNMctS0hKlpaPR5vNOTNsW0",
          authDomain: "concours-peche.firebaseapp.com",
          projectId: "concours-peche",
          storageBucket: "concours-peche.firebasestorage.app",
          messagingSenderId: "376446532224",
          appId: "1:376446532224:web:4f9c1ffd2f4fe3ef450465"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const { useState, useEffect, createElement: h } = React;

        // --- ICONES ---
        const Fish = () => h('svg', { width: 40, height: 40, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, className: 'mx-auto mb-2' }, h('path', { d: 'M23 12c-2.4 3.4-5.4 6-9 6s-6.6-2.6-9-6c2.4-3.4 5.4-6 9-6s6.6 2.6 9 6Z' }));
        const LogOut = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 }, h('path', { d: 'M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9' }));

        function FishingApp() {
            const [user, setUser] = useState(null);
            const [page, setPage] = useState('login');
            const [fishermen, setFishermen] = useState([]);

            // Surveillance de la connexion
            useEffect(() => {
                auth.onAuthStateChanged(u => u ? setUser(u) : setUser(null));
            }, []);

            // Lecture des donnÃ©es en temps rÃ©el sur Firebase
            useEffect(() => {
                if (!user) return;
                const unsub = db.collection("fishermen").onSnapshot(snap => {
                    setFishermen(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                return () => unsub();
            }, [user]);

            // --- FONCTION ENREGISTRER UN PECHEUR ---
            const saveFisherman = async (nom, prenom, poste) => {
                await db.collection("fishermen").add({ nom, prenom, poste: parseInt(poste), weights: [] });
                setPage('index');
            };

            // --- FONCTION ENREGISTRER UNE PESÃ‰E ---
            const addWeight = async (id, period, weight, count) => {
                const fish = fishermen.find(f => f.id === id);
                const newWeights = [...(fish.weights || []), { period, weight: parseFloat(weight), count: parseInt(count) }];
                await db.collection("fishermen").doc(id).update({ weights: newWeights });
                alert("PesÃ©e enregistrÃ©e !");
            };

            // --- PAGE CONNEXION ---
            if (!user) {
                return h('div', { className: 'flex items-center justify-center min-h-screen bg-blue-900 p-4' },
                    h('div', { className: 'bg-white p-6 rounded-xl shadow-lg w-full max-w-sm' },
                        h(Fish),
                        h('h2', { className: 'text-center font-bold mb-4' }, 'ACCÃˆS CONCOURS'),
                        h('input', { id: 'em', type: 'email', placeholder: 'Email', className: 'w-full p-2 border mb-2' }),
                        h('input', { id: 'pw', type: 'password', placeholder: 'Code', className: 'w-full p-2 border mb-4' }),
                        h('button', { 
                            onClick: () => auth.signInWithEmailAndPassword(document.getElementById('em').value, document.getElementById('pw').value).catch(e => alert("Erreur d'accÃ¨s")),
                            className: 'w-full bg-blue-600 text-white p-2 rounded' 
                        }, 'Entrer')
                    )
                );
            }

            // --- MENU PRINCIPAL ---
            if (page === 'index') {
                return h('div', { className: 'p-4' },
                    h('div', { className: 'flex justify-between items-center mb-6' },
                        h('h1', { className: 'font-bold text-blue-900' }, 'TABLEAU DE BORD'),
                        h('button', { onClick: () => auth.signOut() }, h(LogOut))
                    ),
                    h('div', { className: 'grid grid-cols-1 gap-4' },
                        h('button', { onClick: () => setPage('inscription'), className: 'bg-orange-500 text-white p-4 rounded-lg font-bold' }, 'ðŸ“ Inscrire un PÃªcheur'),
                        h('button', { onClick: () => setPage('resultats'), className: 'bg-green-600 text-white p-4 rounded-lg font-bold' }, 'ðŸ† Classement en Direct'),
                        h('div', { className: 'grid grid-cols-2 gap-2 mt-4' },
                            [1,2,3,4,5,6,7,8].map(n => h('button', { 
                                onClick: () => setPage(`poste${n}`),
                                className: 'bg-white border-2 border-blue-200 p-4 rounded font-bold'
                            }, `POSTE ${n}`))
                        )
                    )
                );
            }

            // --- PAGE INSCRIPTION ---
            if (page === 'inscription') {
                return h('div', { className: 'p-4' },
                    h('button', { onClick: () => setPage('index'), className: 'mb-4 text-blue-600' }, 'â† Retour'),
                    h('h2', { className: 'font-bold mb-4' }, 'NOUVELLE INSCRIPTION'),
                    h('input', { id: 'nom', placeholder: 'Nom', className: 'w-full p-2 border mb-2' }),
                    h('input', { id: 'pre', placeholder: 'PrÃ©nom', className: 'w-full p-2 border mb-2' }),
                    h('input', { id: 'pos', type: 'number', placeholder: 'NÂ° de Poste', className: 'w-full p-2 border mb-4' }),
                    h('button', { 
                        onClick: () => saveFisherman(document.getElementById('nom').value, document.getElementById('pre').value, document.getElementById('pos').value),
                        className: 'w-full bg-blue-600 text-white p-3 rounded'
                    }, 'Valider l\'inscription')
                );
            }

            // --- PAGE RÃ‰SULTATS ---
            if (page === 'resultats') {
                const sorted = [...fishermen].sort((a, b) => {
                    const weightA = (a.weights || []).reduce((s, w) => s + w.weight, 0);
                    const weightB = (b.weights || []).reduce((s, w) => s + w.weight, 0);
                    return weightB - weightA;
                });
                return h('div', { className: 'p-4' },
                    h('button', { onClick: () => setPage('index'), className: 'mb-4 text-blue-600' }, 'â† Retour'),
                    h('h2', { className: 'font-bold mb-4' }, 'CLASSEMENT GÃ‰NÃ‰RAL'),
                    sorted.map((f, i) => h('div', { className: 'bg-white p-3 mb-2 rounded shadow flex justify-between' },
                        h('span', null, `${i+1}. ${f.nom} (Poste ${f.poste})`),
                        h('span', { className: 'font-bold' }, `${(f.weights || []).reduce((s,w) => s+w.weight, 0)} g`)
                    ))
                );
            }

            // --- PAGES DES POSTES ---
            if (page.startsWith('poste')) {
                const n = parseInt(page.replace('poste', ''));
                const f = fishermen.find(fish => fish.poste === n);
                return h('div', { className: 'p-4' },
                    h('button', { onClick: () => setPage('index'), className: 'mb-4 text-blue-600' }, 'â† Retour'),
                    h('h2', { className: 'font-bold' }, `SAISIE POSTE ${n}`),
                    f ? h('div', null, 
                        h('p', { className: 'mb-4' }, `PÃªcheur : ${f.nom} ${f.prenom}`),
                        h('select', { id: 'per', className: 'w-full p-2 border mb-2' }, 
                            h('option', { value: 'Matin' }, 'Matin'),
                            h('option', { value: 'AprÃ¨s-midi' }, 'AprÃ¨s-midi')
                        ),
                        h('input', { id: 'wei', type: 'number', placeholder: 'Poids (grammes)', className: 'w-full p-2 border mb-2' }),
                        h('input', { id: 'cnt', type: 'number', placeholder: 'Nombre de poissons', className: 'w-full p-2 border mb-4' }),
                        h('button', { 
                            onClick: () => addWeight(f.id, document.getElementById('per').value, document.getElementById('wei').value, document.getElementById('cnt').value),
                            className: 'w-full bg-green-600 text-white p-3 rounded'
                        }, 'Enregistrer la pesÃ©e')
                    ) : h('p', { className: 'text-red-500' }, 'Aucun pÃªcheur inscrit Ã  ce poste.')
                );
            }
        }

        ReactDOM.render(h(FishingApp), document.getElementById('root'));
    </script>
</body>
</html>
