<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Concours de Pêche PRO</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    <script>
        // Ta configuration Firebase [cite: 5, 42]
        const firebaseConfig = {
          apiKey: "AIzaSyB44m6DoeyQSNMctS0hKlpaPR5vNOTNsW0",
          authDomain: "concours-peche.firebaseapp.com",
          projectId: "concours-peche",
          storageBucket: "concours-peche.firebasestorage.app",
          messagingSenderId: "376446532224",
          appId: "1:376446532224:web:4f9c1ffd2f4fe3ef450465",
          measurementId: "G-L9PKD3JZL0"
        };

        // Initialisation correcte [cite: 6, 7]
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const { useState, useEffect, createElement: h } = React;

        function FishingApp() {
            const [user, setUser] = useState(null);
            const [page, setPage] = useState('login');
            const [fishermen, setFishermen] = useState([]);

            useEffect(() => {
                auth.onAuthStateChanged(u => {
                    if(u) { setUser(u); setPage('index'); }
                    else { setUser(null); setPage('login'); }
                });
            }, []);

            useEffect(() => {
                if (!user) return;
                // On écoute la collection que tu as créée 
                const unsub = db.collection("fishermen").onSnapshot(snap => {
                    const list = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setFishermen(list);
                });
                return () => unsub();
            }, [user]);

            if (page === 'login' && !user) {
                return h('div', { className: 'min-h-screen bg-blue-900 flex items-center justify-center p-4' },
                    h('div', { className: 'bg-white p-6 rounded-lg w-full max-w-sm' },
                        h('h1', { className: 'text-xl font-bold mb-4 text-center' }, 'CONNEXION'),
                        h('input', { id: 'email', type: 'email', placeholder: 'Email', className: 'w-full p-2 mb-2 border' }),
                        h('input', { id: 'pass', type: 'password', placeholder: 'Code', className: 'w-full p-2 mb-4 border' }),
                        h('button', { 
                            onClick: () => auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('pass').value),
                            className: 'w-full bg-blue-600 text-white p-2 rounded' 
                        }, 'Se connecter')
                    )
                );
            }

            return h('div', { className: 'p-4' },
                h('div', { className: 'flex justify-between items-center mb-6' },
                    h('h1', { className: 'font-bold' }, 'CONCOURS PÊCHE'),
                    h('button', { onClick: () => auth.signOut(), className: 'text-red-500' }, 'Quitter')
                ),
                h('div', { className: 'grid grid-cols-2 gap-4' },
                    [1,2,3,4,5,6,7,8].map(n => h('button', { 
                        className: 'bg-white p-4 rounded border shadow-sm font-bold' 
                    }, `POSTE ${n}`))
                )
            );
        }

        ReactDOM.render(h(FishingApp), document.getElementById('root'));
    </script>
</body>
</html>
